import CodeBlock from '@theme/CodeBlock'
import SchemaNode from '@theme/Schema'
import { Box } from '@radix-ui/themes'

import sentimentPythonSample from "./assets/sentiment.py"
import jobsSpec from "!api-schema-loader!@site/spec/jobs.yaml"

# Sentiment analysis

Speechmatics enables you to understand the sentiment of what was spoken in your audio. With just a single API call, you can quickly transcribe and extract the sentiment, either positive, negative or neutral to quickly detect areas of conversation to analyse further.

If you're new to Speechmatics, please see our guide on [Transcribing a File](/speech-to-text/complete-transcription/quickstart). Once you are set up, include the following config to enable Sentiment:

```json
{
  "type": "transcription",
  "transcription_config": {
    "language": "en"
  },
  "sentiment_analysis_config": {}
}
```

## Quick start

Python client example to return transcription with sentiment analysis for an audio file.

<CodeBlock language="python" showLineNumbers>
  {sentimentPythonSample}
</CodeBlock>

## Understanding the Response

Sentiment results are only available in the JSON output.

Segments of the transcript are labeled with either positive, negative or neutral and a confidence score. This score indicates the model's certainty regarding the assigned sentiment prediction.

<Box m="2">
  <SchemaNode schema={jobsSpec.definitions.SentimentAnalysisResult} expanded />
</Box>

```json
{
  "job": { ... },
  "metadata": {
    "created_at": "2023-07-17T15:01:48.412714Z",
    "type": "transcription",
    "transcription_config": {
      "language": "en",
      "diarization": "speaker"
    },
    "sentiment_analysis_config": {}
    ...
  },
  "results": [...],
  // highlight-start
  "sentiment_analysis": {
    "segments": [
      {
        "confidence": 0.88,
        "end_time": 7.94,
        "sentiment": "positive",
        "speaker": "S1",
        "start_time": 3.0,
        "text": "We're delighted that you've decided to try our speech to text software to get going."
      },
      {
        "confidence": 0.76,
        "end_time": 12.18,
        "sentiment": "neutral",
        "speaker": "S1",
        "start_time": 7.95,
        "text": "Just create an API key and submit a transcription request to our API."
      }
    ],
    "summary": {
      "overall": {
        "negative_count": 0,
        "neutral_count": 1,
        "positive_count": 1
      },
      "speakers": [
        {
          "speaker": "S1",
          "negative_count": 0,
          "neutral_count": 1,
          "positive_count": 1
        }
      ]
    }
  }
  // highlight-end
}
```

## Considerations

- Sentiment is only supported for English
- Typically, segments equate to full sentences. However, in cases of short utterances composed of 1-2 words, these can be combined with a neighboring sentence to form a segment
- Punctuation plays a significant role in the accuracy of the Sentiment. It is therefore recommended to avoid disabling any end of sentence [Punctuation Marks](https://docs.speechmatics.com/features/punctuation-settings) or reducing the [Punctuation Sensitivity](https://docs.speechmatics.com/features/punctuation-settings) to ensure the best possible results
- Speaker or channel labels will only be available if [Diarization](../features/diarization.mdx) is enabled. By default when Diarization is not enabled "speaker":"UU" is returned to indicate that speakers of each segment are unknown
- Speaker Change is not supported in combination with Sentiment

# Error Responses

### Unsupported Language

Currently Sentiment is only supported for English.

If Sentiment is requested for an unsupported language, the transcription process will complete. However, the Sentiment will not be returned, and an error message will be included in the final JSON output.

```json
{
  "job": { ... },
  "metadata": {
    "created_at": "2023-05-26T15:01:48.412714Z",
    "type": "transcription",
    "transcription_config": {
      "language": "cy"
    },
    "sentiment_analysis_config": {},
    "sentiment_analysis_errors": [
      {"type": "unsupported_language", "message": "Sentiment analysis not supported for cy."}
    ],
    ...
  },
  "results": [...]
}
```

### Sentiment Failed

If Sentiment fails, the transcription process will complete but the Sentiment will not be returned, and an error message will be included in the final JSON output.

```json
{
  "job": { ... },
  "metadata": {
    "created_at": "2023-05-26T15:01:48.412714Z",
    "type": "transcription",
    "transcription_config": {
      "language": "en"
    },
    "sentiment_analysis_config": {},
    "sentiment_analysis_errors": [
      {"type": "sentiment_analysis_failed", "message": "Sentiment Analysis failed."}
    ],
    ...
  },
  "results": [...]
}
```
